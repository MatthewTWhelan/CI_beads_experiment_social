<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Beads experiment</title>
    <script src="https://unpkg.com/jspsych@7.1.2"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.1.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.0"></script>
    <link href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css" rel="stylesheet" type="text/css"/>

    <style>
        body {overflow: hidden;}
    </style>
</head>
<body>
<script>

    // Creating functions. Most of these are for animations.

    function getRandomInt(max) {
    return Math.floor(Math.random() * max);
    }

    // Jar and agent coming onto the screen, and then remaining there for 1 second
    function jarAgentEnteringScreen (agent_img_path) {
        let percentage;
        for (let step = 0; step < 131; step++) {
            percentage = step / 2 - 15;
            const change_jar_on = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: `
                <img src='img/jar_covered.png'
                style="position:absolute;
                top:50%;
                left:${percentage}%;
                margin-top:-233px;
                margin-left:-233px;"/>

                <img src="${agent_img_path}"
                 style="position:absolute;
                 top:30%;
                 left:${120 - percentage}%;
                 height:200px;
                 width:auto"/>

                <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and agent</p>
                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(change_jar_on);
        }
        const jar_agent_still = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `
            <img src='img/jar_covered.png'
            style="position:absolute;
            top:50%;
            left:50%;
            margin-top:-233px;
            margin-left:-233px;"/>

            <img src="${agent_img_path}"
             style="position:absolute;
             top:30%;
             left:70%;
             height:200px;
             width:auto"/>

            <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and agent</p>
            `,
            choices: "NO_KEYS",
            trial_duration: 1000,
        }
        timeline.push(jar_agent_still);
    }

    // Jar and agent leaving the screen
    function jarAgentLeavingScreen (agent_img_path) {
        let percentage;
        for (let step = 0; step < 131; step++) {
            percentage = 50 - step / 2;
            const change_jar_off = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: `

                <img src='img/jar_covered.png'
                style="position:absolute;
                top:50%;
                left:${percentage}%;
                margin-top:-233px;
                margin-left:-233px;"/>

                <p style="position:absolute; top:90%; left:50%; transform: translate(-50%, -50%);">New jar and agent</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(change_jar_off);
        }
    }

    function agentChoosingBeads (agent_img_path) {
        let percentage;
        let hand_img_path;
        for (let step = 0; step < 261; step++) {
            if (step < 131) {
                percentage = step / 2 - 10;
                hand_img_path = 'img/hand_back.png'
            } else {
                percentage = 120 - step / 2;
                hand_img_path = 'img/hand_fist_edited.png'
            }

            const agent_choosing_beads = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: `

                <img src="${hand_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:50%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:300px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:50%;
                margin-top:-480px;
                margin-left:-300px;"/>

                <img src="${agent_img_path}"
                 style="position:absolute;
                 top:30%;
                 left:70%;
                 height:200px;
                 width:auto"/>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">Agent picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(agent_choosing_beads);
        }
    }

    function agent_viewing_beads(agent_img_path, agent_decision_img_path) {
        const agent_viewing_beads = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `

            <img src='img/jar_covered_opened.png'
            style="position:absolute;
            top:50%;
            left:50%;
            margin-top:-480px;
            margin-left:-300px;"/>

            <img src="${agent_img_path}"
             style="position:absolute;
             top:30%;
             left:70%;
             height:200px;
             width:auto"/>

             <img src="img/hand_back.png"
             style="position:absolute;
             top:32%;
             left:73%;
             height:120px;
             width:auto;
             "/>



            <p style="position:absolute;
            top:90%;
            left:50%;
            transform: translate(-50%, -50%);">Agent making a decision</p>

            `,
            choices: "NO_KEYS",
            trial_duration: 1500,
        }
        timeline.push(agent_viewing_beads);

        const agent_decided = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `

            <img src='img/jar_covered_opened.png'
            style="position:absolute;
            top:50%;
            left:50%;
            margin-top:-480px;
            margin-left:-300px;"/>


             <img src="img/hand_back.png"
             style="position:absolute;
             top:32%;
             left:73%;
             height:120px;
             width:auto;
             "/>

             <div style="position:absolute;
             top:30%;
             left:70%;
             height: 300px;">
            <img src="${agent_img_path}"
             style="position: relative;
             height:200px;
             width:auto"/>

            <img src="${agent_decision_img_path}"
             style="position: relative;
             top: 80px;
             left: -105px;
             transform: translate(-50%, -50%);"/>
             </div>

            <p style="position:absolute;
            top:90%;
            left:50%;
            transform: translate(-50%, -50%);">Agent making a decision</p>

            `,
            choices: "NO_KEYS",
            trial_duration: 1000,
        }
        timeline.push(agent_decided);
    }

    function agentReplacingBeads (agent_img_path, agent_decision_img_path) {
        let percentage;
        let hand_img_path;
        for (let step = 0; step < 261; step++) {
            if (step < 131) {
                percentage = step / 2 - 10;
                hand_img_path = 'img/hand_fist_edited.png'
            } else {
                percentage = 120 - step / 2;
                hand_img_path = 'img/hand_back.png'
            }

            const agent_replacing_beads = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: `

                <img src="${hand_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:50%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:300px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:50%;
                margin-top:-480px;
                margin-left:-300px;"/>

                <div style="position:absolute;
                 top:30%;
                 left:70%;
                 height: 300px;">
                <img src="${agent_img_path}"
                 style="position: relative;
                 height:200px;
                 width:auto"/>

                <img src="${agent_decision_img_path}"
                 style="position: relative;
                 top: 80px;
                 left: -105px;
                 transform: translate(-50%, -50%);"/>
                 </div>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">Agent replacing beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(agent_replacing_beads);
        }
    }

    function participantChoosingBeads (agent_img_path, agent_decision_img_path, participant_beads_img_path) {
        let percentage;
        let hand_img_path;
        for (let step = 0; step < 261; step++) {
            if (step < 131) {
                percentage = step / 2 - 10;
                hand_img_path = 'img/hand_back.png'
            } else {
                percentage = 120 - step / 2;
                hand_img_path = 'img/hand_fist_edited.png'
            }

            const participant_choosing_beads = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: `

                <img src="${hand_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:50%;
                 transform: translate(-50%, -50%) rotate(180deg);
                 height:300px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:50%;
                margin-top:-480px;
                margin-left:-300px;"/>

                <div style="position:absolute;
                 top:30%;
                 left:70%;
                 height: 300px;">
                <img src="${agent_img_path}"
                 style="position: relative;
                 height:200px;
                 width:auto"/>

                <img src="${agent_decision_img_path}"
                 style="position: relative;
                 top: 80px;
                 left: -105px;
                 transform: translate(-50%, -50%);"/>
                 </div>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">You are picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(participant_choosing_beads);
        }

        for (let step = 0; step < 131; step++) {
            percentage = 120 - step/2;
            const participant_viewing_beads = {
                type: jsPsychHtmlKeyboardResponse,
                stimulus: `

                <img src="${participant_beads_img_path}"
                 style="position:absolute;
                 top:${percentage}%;
                 left:25%;
                 transform: translate(-50%, -50%);
                 height:400px;
                 width:auto;
                 "/>

                <img src='img/jar_covered_opened.png'
                style="position:absolute;
                top:50%;
                left:50%;
                margin-top:-480px;
                margin-left:-300px;"/>

                <div style="position:absolute;
                 top:30%;
                 left:70%;
                 height: 300px;">
                <img src="${agent_img_path}"
                 style="position: relative;
                 height:200px;
                 width:auto"/>

                <img src="${agent_decision_img_path}"
                 style="position: relative;
                 top: 80px;
                 left: -105px;
                 transform: translate(-50%, -50%);"/>
                 </div>

                <p style="position:absolute;
                top:90%;
                left:50%;
                transform: translate(-50%, -50%);">You are picking beads</p>

                `,
                choices: "NO_KEYS",
                trial_duration: 8,
            }
            timeline.push(participant_viewing_beads);
        }

    }

    function participantStateConfidence (agent_img_path, agent_decision_img_path, participant_beads_img_path) {
        const participant_stating_confidence = {
            type: jsPsychHtmlSliderResponse,
            stimulus: `

            <div style="z-index: -1">

            <img src="${participant_beads_img_path}"
             style="position:absolute;
             top:55%;
             left:25%;
             transform: translate(-50%, -50%);
             height:400px;
             width:auto;
             "/>

            <img src='img/jar_covered_opened.png'
            style="position:absolute;
            z-index: -1;
            top:50%;
            left:50%;
            margin-top:-480px;
            margin-left:-300px;"/>

            <div style="position:absolute;
             top:30%;
             left:70%;
             height: 300px;">
            <img src="${agent_img_path}"
             style="position: relative;
             height:200px;
             width:auto"/>

            <img src="${agent_decision_img_path}"
             style="position: relative;
             top: 80px;
             left: -105px;
             transform: translate(-50%, -50%);"/>
             </div>

            </div>

            <div style="width:200px;
            margin-bottom: 40px;
            margin-top: 20px;">
            <p>Choose your confidence for a particular colour.</p>
            <div style="width:50px; float: left;">
            <p><img src="img/red_bead.png"/></p>
            </div>
            <div style="width:50px; float: right;">
            <p><img src="img/green_bead.png"/></p>
            </div>
            </div>

            `,
            slider_width: 100,
        }
        timeline.push(participant_stating_confidence);
    }

    function fixation() {
        const fixation = {
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `<div style="font-size:60px;">+</div>`,
            choices: "NO_KEYS",
            trial_duration: 1000,
            data: {
                task: 'fixation'
            }
        }
        timeline.push(fixation);
    }

//////////////////////// Begin experiment timeline ///////////////////////////////

    const jsPsych = initJsPsych({
            on_finish: function(){
                jsPsych.data.displayData();
            }
        });

    let timeline = [];

    const welcome = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: "Welcome to the experiment. Press any key to begin."
    }
    timeline.push(welcome);

    const instructions = {
        type: jsPsychHtmlKeyboardResponse,
        choices: [' '],
        stimulus: `

        <p>Instructions will go here.</p>

        <p>Press 'space' key to continue.</p>

        `
    }
    timeline.push(instructions);


    const enter_fullscreen = {
    type: jsPsychFullscreen,
    message: '<p>The experiment will switch to full screen mode when you press the button below. You can exit any time by hitting the Esc key.</p>',
    fullscreen_mode: true
    }
    timeline.push(enter_fullscreen);

    let agent_img_path;
    let agent_choice;
    let bead_samples;
    for (let trial = 0; trial < 5; trial++) {
        agent_img_path = `img/faces/${trial + 1}.png`;
        agent_choice = `img/agent_choices/${(trial + 1) * 5}.png`;
        bead_samples = `img/bead_samples/${trial + 1}red.png`;

        jarAgentEnteringScreen(agent_img_path);
        agentChoosingBeads(agent_img_path);
        agent_viewing_beads(agent_img_path, agent_choice);
        agentReplacingBeads(agent_img_path, agent_choice);
        participantChoosingBeads(agent_img_path, agent_choice, bead_samples);
        participantStateConfidence(agent_img_path, agent_choice, bead_samples);
        fixation();
    }





//     const trial = {
//     type: jsPsychHtmlSliderResponse,
//     stimulus: `
// <div style="z-index:-1; position:absolute; top:50%; left:50%;
//              margin-top:-233px; margin-left:-233px;"><img src='img/jar_covered.png' /></div>
// <div style="width:200px;
// margin-bottom: 40px;">
//         <p>Choose your confidence for a particular colour.</p>
//         <div style="width:50px; float: left;">
//             <p><img src="img/red_bead.png"/></p>
//         </div>
//         <div style="width:50px; float: right;">
//             <p><img src="img/green_bead.png"/></p>
//         </div>
//
//         </div>
//
// `,
//         slider_width: 100,
//     // labels: ['100% chance of a red bead', '50% chance of either red or green', '100% chance of a green bead']
// };

    // timeline.push(trial);

    // jarAgentLeavingScreen();

    // const welcome = {
    //     type: jsPsychHtmlKeyboardResponse,
    //     stimulus: "Welcome to the experiment. Press any key to begin."
    // }
    // timeline.push(welcome);
    //
    // const instructions = {
    //     type: jsPsychHtmlKeyboardResponse,
    //     choices: [' '],
    //     stimulus: `
    //
    //     <p>Instructions will go here.</p>
    //
    //     <p>Press 'space' key to continue.</p>
    //
    //     `
    // }
    // timeline.push(instructions);
    //
    //
    // const jar = {
    //     type: jsPsychHtmlKeyboardResponse,
    //     stimulus: `
    //     <img src='img/jar_covered.png' style="position:absolute; top:50%; left:50%;
    //         margin-top:-233px; margin-left:-233px;"></img>
    //     `,
    // }
    // timeline.push(jar);

    // let num_red_samples;
    // for (let iter = 0; iter < 5; iter++) {
    //     let face_path = `img/faces/${iter + 1}.png`;
    //
    //     num_red_samples = getRandomInt(6) + 1;
    //
    //     const new_trial_procedure = {
    //         type: jsPsychHtmlKeyboardResponse,
    //         stimulus: `
    //
    //
    //         `
    //
    //     }
    //
    //
    //     const test_procedure = {
    //         type: jsPsychHtmlKeyboardResponse,
    //         stimulus: `
    //         <img src='img/sample_${num_red_samples}_red.png'
    //         style="position:absolute;
    //         top:50%;
    //         left:50%;
    //         margin-top:-47px;
    //         margin-left:-45px;"></img>
    //         <img src="${face_path}"
    //         style="position:absolute;
    //         top:30%;
    //         left:80%;
    //         height:200px;
    //         width:auto"></img>
    //         `,
    //         data: {
    //             task: 'trial',
    //             number_red_samples: num_red_samples
    //         }
    //     }
    //     timeline.push(test_procedure);
    //
    //
    //     // const test_stimuli = [
    //     // {stimulus: `
    //     //     <img src='img/sample_1_red.png'
    //     //     style="position:absolute;
    //     //     top:50%;
    //     //     left:50%;
    //     //     margin-top:-47px;
    //     //     margin-left:-45px;"></img>
    //     //     <img src="${face_path}"
    //     //     style="position:absolute;
    //     //     top:50%;
    //     //     left:80%";></img>
    //     //     `},
    //     // {stimulus: `<img src='img/sample_2_red.png' ></img>`},
    //     // // {stimulus: "img/sample_3_red.png"},
    //     // // {stimulus: "img/sample_4_red.png"},
    //     // // {stimulus: "img/sample_5_red.png"},
    //     // // {stimulus: "img/sample_6_red.png"},
    //     // // {stimulus: "img/sample_7_red.png"},
    //     //     ]
    //
    //     const fixation = {
    //         type: jsPsychHtmlKeyboardResponse,
    //         stimulus: `<div style="font-size:60px;">+</div>`,
    //         choices: "NO_KEYS",
    //         trial_duration: 1000,
    //         data: {
    //             task: 'fixation'
    //         }
    //     }
    //     timeline.push(fixation);
    //
    //     // const test = {
    //     //     type: jsPsychHtmlKeyboardResponse,
    //     //     stimulus: jsPsych.timelineVariable('stimulus'),
    //     //     // choices: ['f', 'j'],
    //     //     data: {
    //     //         task: 'response',
    //     //     },
    //     // }
    //     //
    //     // const test_procedure = {
    //     //     timeline: [fixation, test],
    //     //     timeline_variables: test_stimuli,
    //     //     randomize_order: true,
    //     //     repetitions: 1,
    //     // }
    //     // timeline.push(test_procedure);
    //
    //
    // }







    jsPsych.run(timeline);

</script>
</body>
</html>
